<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Chat Room</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            width: 95%;
            max-width: 1200px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .main-content {
            flex: 1;
            display: flex;
            gap: 20px;
            padding: 20px;
            min-height: 0;
            overflow: hidden;
        }
        
        .sidebar {
            width: 250px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .users-list {
            flex: 1;
        }
        
        .users-list h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .user-item {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .user-name {
            font-weight: bold;
            color: #333;
        }
        
        .invite-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        
        .invite-btn:hover {
            background: #45b7b8;
        }
        
        .game-selector {
            position: relative;
        }
        
        .game-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
             max-height: 200px;       
            overflow-y: auto;
            z-index: 1000;
        }
        
        .game-menu.show {
            display: block;
        }
        
        .game-option {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }
        
        .game-option:hover {
            background: #f0f0f0;
        }
        
        .game-option:last-child {
            border-bottom: none;
        }
        
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .chat-messages {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-height: 200px;
        }
        
        .chat-section.with-game .chat-messages {
         flex: 1;
         min-height: 150px;
         }

        .chat-section.with-game .game-area.active {
        flex: 0 0 300px; /* Fixed height όταν είναι ενεργό */
        } 


        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            animation: fadeIn 0.3s ease-in;
        }
        
        .message.system {
            background: #e3f2fd;
            color: #1976d2;
            text-align: center;
        }
        
        .message.user {
            background: #f5f5f5;
            border-left: 4px solid #4ecdc4;
        }
        
        .message.game {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        
        .message-header {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .chat-input {
            display: flex;
            gap: 10px;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .chat-input input:focus {
            border-color: #4ecdc4;
        }
        
        .chat-input button {
            padding: 12px 20px;
            background: #4ecdc4;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .chat-input button:hover {
            background: #45b7b8;
        }
        
        .game-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
            flex-direction: column;
            align-items: center;
            flex: 0 0 420px;
            margin: 20px auto 0 auto;
            min-width: 0;
            max-width: 100vw;
        }
        
        .game-area.active {
            display: flex;
        }
        
        .game-board {
            display: grid;
            gap: 5px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .tic-tac-toe {
            grid-template-columns: repeat(3, 80px);
            grid-template-rows: repeat(3, 80px);
        }
        
        .memory-board {
            grid-template-columns: repeat(4, 80px);
            grid-template-rows: repeat(4, 80px);
        }
        
        .game-cell {
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .game-cell:hover {
            background: #e0e0e0;
            transform: scale(1.05);
        }
        
        .game-cell.X {
            background: #ff6b6b;
            color: white;
        }
        
        .game-cell.O {
            background: #4ecdc4;
            color: white;
        }
        
        .game-cell.flipped {
            background: #fff3e0;
            transform: rotateY(180deg);
        }
        
        .game-cell.matched {
            background: #c8e6c9;
            border-color: #4caf50;
        }
        
        .game-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }
        
        .game-controls input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .game-controls button {
            padding: 8px 16px;
            background: #4ecdc4;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .game-controls button:hover {
            background: #45b7b8;
        }
        
        .rps-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .rps-btn {
            padding: 20px;
            font-size: 40px;
            background: #f0f0f0;
            border: 3px solid #ddd;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .rps-btn:hover {
            background: #4ecdc4;
            color: white;
            transform: scale(1.1);
        }
        
        .game-canvas {
            border: 4px solid #333;
            border-radius: 20px;
            margin: 20px auto;
            display: block;
            background: linear-gradient(180deg, #222 0%, #444 100%);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transition: box-shadow 0.3s;
            max-width: 100%;
            height: auto;
        }
        
        .game-canvas:active {
            box-shadow: 0 0 0 4px #4ecdc4;
        }
        
        .score-board {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .score-item {
            text-align: center;
        }
        
        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .score-label {
            font-size: 14px;
            color: #666;
        }
        
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .login-form {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .login-form h2 {
            margin-bottom: 30px;
            color: #333;
        }
        
        .login-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
        }
        
        .login-form button {
            width: 100%;
            padding: 12px;
            background: #4ecdc4;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .login-form button:hover {
            background: #45b7b8;
        }
        
        .invite-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4ecdc4;
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1500;
            animation: slideIn 0.3s ease-out;
        }
        
        .invite-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .invite-buttons button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .accept-btn {
            background: #4caf50;
            color: white;
        }
        
        .decline-btn {
            background: #f44336;
            color: white;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .palermo-players {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .palermo-player {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .palermo-player:hover {
            background: #e0e0e0;
            transform: scale(1.05);
        }
        
        .palermo-player.dead {
            background: #ffcdd2;
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .palermo-player.alive {
            background: #c8e6c9;
        }
        
        .phase-indicator {
            text-align: center;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            color: #1976d2;
        }
        
        .game-chat-flex {
            display: flex;
            gap: 20px;
            width: 100%;
            height: 100%;
        }
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        @media (max-width: 900px) {
            .game-chat-flex {
                flex-direction: column;
            }
            .game-area, .chat-section {
                width: 100vw;
                min-width: 0;
                max-width: 100vw;
            }
            .game-area {
                margin-top: 0;
                margin-bottom: 10px;
                align-items: center;
            }
            .chat-messages {
                max-height: 200px;
                overflow-y: auto;
            }
            .chat-input {
                position: sticky;
                bottom: 0;
                background: white;
                padding: 10px 0;
                z-index: 100;
            }
        }
        @media (max-width: 480px) {
            .container {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
                box-shadow: none;
            }
            .main-content {
                flex-direction: column-reverse;
                gap: 5px;
                padding: 0;
                width: 100vw;
            }
            .sidebar {
                width: 100vw;
                min-width: 0;
                max-width: 100vw;
                border-radius: 0 0 10px 10px;
                padding: 8px 2px;
                box-shadow: none;
                margin-bottom: 5px;
            }
            .game-area {
                min-width: 0;
                max-width: 100vw;
                flex: 0 0 auto;
                align-items: center;
                margin: 10px auto 0 auto;
            }
            .game-canvas {
                width: 98vw !important;
                min-width: unset;
                min-height: 200px;
                max-width: 98vw;
                max-height: 70vw;
                display: block;
                margin: 0 auto;
            }
            .game-board {
                transform: scale(0.6);
            }
            .score-board {
                padding: 5px;
                font-size: 12px;
            }
            .login-form {
                padding: 20px;
                border-radius: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            🎮 Gaming Chat Room 🎮
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="users-list">
                    <h3>Online Users</h3>
                    <div id="usersList"></div>
                </div>
            </div>
            
          <div class="game-chat-flex">
            <div class="game-area" id="gameArea">
                <div id="gameContent"></div>
            </div>
            <div class="chat-section">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input">
                    <input type="text" id="messageInput" placeholder="Type your message..." maxlength="500">
                    <button onclick="sendMessage()">Send</button>
                </div>
            </div>
          </div>

    
    <div class="login-screen" id="loginScreen">
        <div class="login-form">
            <h2>Welcome to Gaming Chat Room!</h2>
            <input type="text" id="usernameInput" placeholder="Enter your username..." maxlength="20">
            <button onclick="joinRoom()">Join Room</button>
            <div id="loginError" style="color: red; margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        const socket = io();
        let currentUser = null;
        let currentGame = null;
        let gameMenuOpen = null;
        let gameData = {};

        // Login functionality
        function joinRoom() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                document.getElementById('loginError').textContent = 'Please enter a username';
                return;
            }
            socket.emit('join', username);
        }

        document.getElementById('usernameInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') joinRoom();
        });

        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Socket event handlers
        socket.on('joinSuccess', (data) => {
            currentUser = data;
            document.getElementById('loginScreen').style.display = 'none';
            updateUsersList(data.users);
            addMessage('system', 'Welcome to the Gaming Chat Room!');
        });

        socket.on('joinFailed', (error) => {
            document.getElementById('loginError').textContent = error;
        });

        socket.on('userJoined', (data) => {
            updateUsersList(data.users);
            addMessage('system', `${data.username} joined the room`);
        });

        socket.on('userLeft', (data) => {
            updateUsersList(data.users);
            addMessage('system', `${data.username} left the room`);
        });

        socket.on('message', (data) => {
            addMessage('user', data.message, data.username);
        });

        socket.on('gameMessage', (message) => {
            addMessage('game', message);
        });

        socket.on('gameInvite', (data) => {
            showInviteNotification(data);
        });

        socket.on('gameStarted', (data) => {
            currentGame = data;
            gameData = data;
            showGameArea(data.game);
            addMessage('game', `Game started: ${data.game}`);
        });

        socket.on('gameState', (data) => {
            updateGameState(data);
        });

        socket.on('gameOver', (data) => {
            addMessage('game', data.message);
            setTimeout(() => {
                hideGameArea();
                currentGame = null;
                gameData = {};
            }, 3000);
        });

        socket.on('roundResult', (data) => {
            addMessage('game', data.result);
            if (currentGame && currentGame.game === 'rock-paper-scissors') {
                updateRPSScores(data.scores);
            }
        });

        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (message) {
                socket.emit('message', message);
                input.value = '';
            }
        }

        function addMessage(type, message, username = null) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            if (username) {
                messageDiv.innerHTML = `
                    <div class="message-header">${username}</div>
                    <div>${message}</div>
                `;
            } else {
                messageDiv.textContent = message;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // User list functionality
        function updateUsersList(users) {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            users.forEach(user => {
                if (user.id !== currentUser.id) {
                    const userDiv = document.createElement('div');
                    userDiv.className = 'user-item';
                    userDiv.innerHTML = `
                        <span class="user-name">${user.username}</span>
                        <button class="invite-btn" onclick="toggleGameMenu('${user.id}', this)">Invite</button>
                    `;
                    usersList.appendChild(userDiv);
                }
            });
        }

        function toggleGameMenu(userId, button) {
            if (gameMenuOpen === userId) {
                hideGameMenu();
                return;
            }
            
            hideGameMenu();
            gameMenuOpen = userId;
            
            const menu = document.createElement('div');
            menu.className = 'game-menu show';
            menu.innerHTML = `
                <div class="game-option" onclick="sendInvite('${userId}', 'tic-tac-toe')">Tic-Tac-Toe</div>
                <div class="game-option" onclick="sendInvite('${userId}', 'rock-paper-scissors')">Rock Paper Scissors</div>
                <div class="game-option" onclick="sendInvite('${userId}', 'number-guess')">Number Guessing</div>
                <div class="game-option" onclick="sendInvite('${userId}', 'memory-game')">Memory Game</div>
                <div class="game-option" onclick="sendInvite('${userId}', 'snake')">Snake</div>
                <div class="game-option" onclick="sendInvite('${userId}', 'air-hockey')">Air Hockey</div>
                <div class="game-option" onclick="sendInvite('${userId}', 'palermo')">Palermo</div>
            `;
            
            button.parentElement.appendChild(menu);
            
            setTimeout(() => {
                document.addEventListener('click', hideGameMenuOnClick);
            }, 0);
        }

        function hideGameMenu() {
            const menus = document.querySelectorAll('.game-menu');
            menus.forEach(menu => menu.remove());
            gameMenuOpen = null;
            document.removeEventListener('click', hideGameMenuOnClick);
        }

        function hideGameMenuOnClick(e) {
            if (!e.target.closest('.game-menu') && !e.target.closest('.invite-btn')) {
                hideGameMenu();
            }
        }

        function sendInvite(userId, game) {
            socket.emit('inviteGame', { opponentId: userId, game });
            hideGameMenu();
            addMessage('game', `Invitation sent for ${game}`);
        }

        // Invite notifications
        function showInviteNotification(data) {
            const notification = document.createElement('div');
            notification.className = 'invite-notification';
            notification.innerHTML = `
                <div><strong>${data.from}</strong> invited you to play <strong>${data.game}</strong></div>
                <div class="invite-buttons">
                    <button class="accept-btn" onclick="respondToInvite('${data.id}', true)">Accept</button>
                    <button class="decline-btn" onclick="respondToInvite('${data.id}', false)">Decline</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 10000);
        }

        function respondToInvite(inviteId, accept) {
            if (accept) {
                socket.emit('acceptInvite', inviteId);
            } else {
                socket.emit('declineInvite', inviteId);
            }
            
            const notification = document.querySelector('.invite-notification');
            if (notification) {
                notification.remove();
            }
        }

        // Game area functionality
        function showGameArea(gameType) {
            const gameArea = document.getElementById('gameArea');
            const gameContent = document.getElementById('gameContent');
            // Αφαιρώ το force cleanup που μηδενίζει currentGame και gameData
            gameContent.innerHTML = '';
            gameArea.classList.add('active');
            switch (gameType) {
                case 'tic-tac-toe':
                    gameContent.innerHTML = createTicTacToeBoard();
                    break;
                case 'rock-paper-scissors':
                    gameContent.innerHTML = createRPSBoard();
                    break;
                case 'number-guess':
                    gameContent.innerHTML = createNumberGuessBoard();
                    break;
                case 'memory-game':
                    gameContent.innerHTML = createMemoryBoard();
                    break;
                case 'snake':
                    gameContent.innerHTML = createSnakeBoard();
                    break;
                case 'air-hockey':
                    gameContent.innerHTML = createAirHockeyBoard();
                    break;
                case 'palermo':
                    gameContent.innerHTML = createPalermoBoard();
                    break;
            }
        }

        function hideGameArea() {
            const gameArea = document.getElementById('gameArea');
            gameArea.classList.remove('active');
        }

        function updateGameState(data) {
            // Αν το gameId που έρχεται από το server δεν είναι το ενεργό, αγνόησέ το
            if (!currentGame || data.gameId !== currentGame.gameId) return;
            gameData = data;
            const game = currentGame.game;
            switch (game) {
                case 'tic-tac-toe':
                    updateTicTacToeBoard(data.state);
                    break;
                case 'number-guess':
                    updateNumberGuessBoard(data.state);
                    break;
                case 'memory-game':
                    updateMemoryBoard(data.state);
                    break;
                case 'snake':
                    updateSnakeBoard(data.state);
                    break;
                case 'air-hockey':
                    updateAirHockeyBoard(data.state);
                    break;
                case 'palermo':
                    updatePalermoBoard(data.state);
                    break;
            }
        }

        // Tic-Tac-Toe
        function createTicTacToeBoard() {
            return `
                <h3>Tic-Tac-Toe</h3>
                <div class="game-board tic-tac-toe" id="ticTacToeBoard">
                    ${Array(9).fill(0).map((_, i) => `<div class="game-cell" onclick="makeTicTacToeMove(${i})"></div>`).join('')}
                </div>
                <div id="gameStatus"></div>
            `;
        }

        function updateTicTacToeBoard(state) {
            const board = document.getElementById('ticTacToeBoard');
            const cells = board.querySelectorAll('.game-cell');
            
            cells.forEach((cell, index) => {
                cell.textContent = state.board[index] || '';
                cell.className = `game-cell ${state.board[index] || ''}`;
            });
            
            const status = document.getElementById('gameStatus');
            if (state.currentPlayer === currentUser.id) {
                status.textContent = 'Your turn!';
            } else {
                status.textContent = `${state.playerNames[state.currentPlayer]}'s turn`;
            }
        }

        function makeTicTacToeMove(index) {
            if (currentGame) {
                socket.emit('ticTacToeMove', { gameId: currentGame.gameId, index });
            }
        }

        // Rock Paper Scissors
        function createRPSBoard() {
            return `
                <h3>Rock Paper Scissors</h3>
                <div class="score-board" id="rpsScores">
                    <div class="score-item">
                        <div class="score-value">0</div>
                        <div class="score-label">You</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value">0</div>
                        <div class="score-label">Opponent</div>
                    </div>
                </div>
                <div class="rps-buttons">
                    <div class="rps-btn" onclick="makeRPSMove('rock')">🪨</div>
                    <div class="rps-btn" onclick="makeRPSMove('paper')">📄</div>
                    <div class="rps-btn" onclick="makeRPSMove('scissors')">✂️</div>
                </div>
                <div id="rpsStatus">Choose your move!</div>
            `;
        }

        function makeRPSMove(move) {
            if (currentGame) {
                socket.emit('rpsMove', { gameId: currentGame.gameId, move });
            }
        }

        function updateRPSScores(scores) {
            const scoreBoard = document.getElementById('rpsScores');
            const scoreItems = scoreBoard.querySelectorAll('.score-value');
            const playerIds = Object.keys(scores);
            
            playerIds.forEach((playerId, index) => {
                if (playerId === currentUser.id) {
                    scoreItems[0].textContent = scores[playerId];
                } else {
                    scoreItems[1].textContent = scores[playerId];
                }
            });
        }

        // Number Guessing Game
        function createNumberGuessBoard() {
            return `
                <h3>Number Guessing Game</h3>
                <div id="numberGameStatus">Loading...</div>
                <div class="game-controls">
                    <input type="number" id="numberInput" placeholder="Enter number (1-100)" min="1" max="100">
                    <button onclick="submitNumber()">Submit</button>
                </div>
                <div id="numberFeedback"></div>
            `;
        }

        function updateNumberGuessBoard(state) {
            const status = document.getElementById('numberGameStatus');
            const feedback = document.getElementById('numberFeedback');
            
            status.textContent = state.feedback;
            
            if (state.setter === currentUser.id && state.targetNumber === null) {
                document.getElementById('numberInput').placeholder = 'Set a number (1-100)';
            } else if (state.guesser === currentUser.id) {
                document.getElementById('numberInput').placeholder = 'Guess the number';
            }
        }

        function submitNumber() {
            const input = document.getElementById('numberInput');
            const value = input.value;
            
            if (value && currentGame) {
                const state = gameData.state;
                if (state.setter === currentUser.id && state.targetNumber === null) {
                    socket.emit('setNumber', { gameId: currentGame.gameId, number: value });
                } else if (state.guesser === currentUser.id) {
                    socket.emit('guessNumber', { gameId: currentGame.gameId, guess: value });
                }
                input.value = '';
            }
        }

        // Memory Game
        function createMemoryBoard() {
            return `
                <h3>Memory Game</h3>
                <div class="score-board">
                    <div class="score-item">
                        <div class="score-value" id="myMemoryScore">0</div>
                        <div class="score-label">You</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value" id="opponentMemoryScore">0</div>
                        <div class="score-label">Opponent</div>
                    </div>
                </div>
                <div class="game-board memory-board" id="memoryBoard">
                    ${Array(16).fill(0).map((_, i) => `<div class="game-cell" onclick="flipCard(${i})"></div>`).join('')}
                </div>
                <div id="memoryStatus">Click on cards to flip them!</div>
            `;
        }

        function updateMemoryBoard(state) {
            const board = document.getElementById('memoryBoard');
            const cells = board.querySelectorAll('.game-cell');
            const status = document.getElementById('memoryStatus');
            
            cells.forEach((cell, index) => {
                const card = state.board[index];
                cell.textContent = card.flipped || card.matched ? card.emoji : '';
                cell.className = `game-cell ${card.flipped ? 'flipped' : ''} ${card.matched ? 'matched' : ''}`;
            });
            
            // Update scores
            document.getElementById('myMemoryScore').textContent = state.scores[currentUser.id] || 0;
            const opponentId = state.players.find(id => id !== currentUser.id);
            document.getElementById('opponentMemoryScore').textContent = state.scores[opponentId] || 0;
            
            if (state.currentPlayer === currentUser.id) {
                status.textContent = 'Your turn!';
            } else {
                status.textContent = `${state.playerNames[state.currentPlayer]}'s turn`;
            }
        }

        function flipCard(index) {
            if (currentGame) {
                socket.emit('memoryFlip', { gameId: currentGame.gameId, index });
            }
        }

        // Snake Game
        function createSnakeBoard() {
            return `
                <h3>Snake Game</h3>
                <div id="snakeStatus">Use mouse to control your snake!</div>
                <canvas id="snakeCanvas" class="game-canvas" width="500" height="500" onclick="changeSnakeDirection(event)"></canvas>
            `;
        }

        function updateSnakeBoard(state) {
            const canvas = document.getElementById('snakeCanvas');
            const ctx = canvas.getContext('2d');
            const cellSize = canvas.width / state.gridSize;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            for (let i = 0; i <= state.gridSize; i++) {
                ctx.beginPath();
                ctx.moveTo(i * cellSize, 0);
                ctx.lineTo(i * cellSize, canvas.height);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i * cellSize);
                ctx.lineTo(canvas.width, i * cellSize);
                ctx.stroke();
            }
            // Draw food with shadow
            ctx.save();
            ctx.shadowColor = '#ff6b6b';
            ctx.shadowBlur = 10;
            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(state.food.x * cellSize, state.food.y * cellSize, cellSize, cellSize);
            ctx.restore();
            // Draw players
            const colors = ['#4ecdc4', '#ff6b6b']; // Πιο διαφορετικά χρώματα
            let colorIndex = 0;
            for (const playerId in state.players) {
                const player = state.players[playerId];
                if (!player.alive) continue;
                
                const isCurrentPlayer = playerId === currentUser.id;
                const color = isCurrentPlayer ? '#4ecdc4' : '#ff6b6b';
                
                // Head
                ctx.save();
                ctx.shadowColor = color;
                ctx.shadowBlur = 15;
                ctx.fillStyle = color;
                const head = player.snake[0];
                ctx.fillRect(head.x * cellSize, head.y * cellSize, cellSize, cellSize);
                
                // Add player indicator on head
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(isCurrentPlayer ? 'YOU' : 'OPP', head.x * cellSize + cellSize/2, head.y * cellSize + cellSize/2 + 4);
                ctx.restore();
                
                // Body
                for (let i = 1; i < player.snake.length; i++) {
                    const seg = player.snake[i];
                    const grad = ctx.createLinearGradient(seg.x * cellSize, seg.y * cellSize, (seg.x+1) * cellSize, (seg.y+1) * cellSize);
                    grad.addColorStop(0, '#fff');
                    grad.addColorStop(1, color);
                    ctx.fillStyle = grad;
                    ctx.globalAlpha = 0.8;
                    ctx.fillRect(seg.x * cellSize, seg.y * cellSize, cellSize, cellSize);
                    ctx.globalAlpha = 1;
                }
                colorIndex++;
            }
            // Update status
            const status = document.getElementById('snakeStatus');
            const myPlayer = state.players[currentUser.id];
            if (myPlayer && !myPlayer.alive) {
                status.textContent = '💀 You died! Game over.';
                canvas.style.filter = 'grayscale(1) blur(2px)';
            } else {
                status.textContent = 'Use mouse to control your snake!';
                canvas.style.filter = '';
            }
        }

        function changeSnakeDirection(event) {
            if (currentGame) {
                const canvas = document.getElementById('snakeCanvas');
                const rect = canvas.getBoundingClientRect();
                const mousePos = {
                    x: event.clientX - rect.left,
                    y: event.clientY - rect.top
                };
                socket.emit('snakeChangeDirection', { gameId: currentGame.gameId, mousePos });
            }
        }

        // Air Hockey Game
        function createAirHockeyBoard() {
            const isMobile = window.innerWidth <= 480;
            const canvasWidth = isMobile ? 350 : 400;
            const canvasHeight = isMobile ? 525 : 600;
            
            return `
                <h3>Air Hockey</h3>
                <div class="score-board">
                    <div class="score-item">
                        <div class="score-value" id="myHockeyScore">0</div>
                        <div class="score-label">You</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value">5</div>
                        <div class="score-label">Goal</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value" id="opponentHockeyScore">0</div>
                        <div class="score-label">Opponent</div>
                    </div>
                </div>
                <canvas id="hockeyCanvas" class="game-canvas" width="${canvasWidth}" height="${canvasHeight}" onmousemove="movePaddle(event)" ontouchmove="movePaddleTouch(event)" ontouchstart="movePaddleTouch(event)"></canvas>
                <div id="hockeyStatus">${isMobile ? 'Touch and drag to move your paddle!' : 'Move your paddle with the mouse!'}</div>
            `;
        }

        function updateAirHockeyBoard(state) {
            const canvas = document.getElementById('hockeyCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw center line
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw goals
            const goalWidth = 100;
            const goalX = (canvas.width - goalWidth) / 2;
            ctx.save();
            ctx.shadowColor = '#ff6b6b';
            ctx.shadowBlur = 10;
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 4;
            ctx.strokeRect(goalX, 0, goalWidth, 20);
            ctx.strokeRect(goalX, canvas.height - 20, goalWidth, 20);
            ctx.restore();
            
            // Draw puck with shadow
            ctx.save();
            ctx.shadowColor = '#fff';
            ctx.shadowBlur = 15;
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(state.puck.x, state.puck.y, state.puck.r, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
            
            // Draw paddles with gradient
            const colors = ['#4ecdc4', '#45b7b8'];
            let colorIndex = 0;
            for (const playerId in state.paddles) {
                const paddle = state.paddles[playerId];
                const grad = ctx.createRadialGradient(paddle.x, paddle.y, paddle.r/4, paddle.x, paddle.y, paddle.r);
                grad.addColorStop(0, '#fff');
                grad.addColorStop(0.5, colors[colorIndex % colors.length]);
                grad.addColorStop(1, '#222');
                ctx.save();
                ctx.shadowColor = colors[colorIndex % colors.length];
                ctx.shadowBlur = 10;
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(paddle.x, paddle.y, paddle.r, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                colorIndex++;
            }
            
            // Update scores
            const playerIds = Object.keys(state.scores);
            document.getElementById('myHockeyScore').textContent = state.scores[currentUser.id] || 0;
            const opponentId = playerIds.find(id => id !== currentUser.id);
            document.getElementById('opponentHockeyScore').textContent = state.scores[opponentId] || 0;
        }

        function movePaddle(event) {
            if (currentGame) {
                const canvas = document.getElementById('hockeyCanvas');
                const rect = canvas.getBoundingClientRect();
                const pos = {
                    x: event.clientX - rect.left,
                    y: event.clientY - rect.top
                };
                socket.emit('airHockeyPaddleMove', { gameId: currentGame.gameId, pos });
            }
        }

        function movePaddleTouch(event) {
            if (currentGame) {
                event.preventDefault(); // Prevent scrolling
                const canvas = document.getElementById('hockeyCanvas');
                const rect = canvas.getBoundingClientRect();
                const touch = event.touches[0];
                const pos = {
                    x: touch.clientX - rect.left,
                    y: touch.clientY - rect.top
                };
                socket.emit('airHockeyPaddleMove', { gameId: currentGame.gameId, pos });
            }
        }

        // Palermo Game
        function createPalermoBoard() {
            return `
                <h3>Palermo (Mafia)</h3>
                <div class="phase-indicator" id="palermoPhase">Loading...</div>
                <div class="palermo-players" id="palermoPlayers"></div>
                <div id="palermoStatus">Loading game...</div>
            `;
        }

        function updatePalermoBoard(state) {
            const playersDiv = document.getElementById('palermoPlayers');
            const phaseDiv = document.getElementById('palermoPhase');
            const statusDiv = document.getElementById('palermoStatus');
            
            // Update phase indicator
            phaseDiv.textContent = state.phase === 'day' ? 'DAY PHASE - Vote to eliminate' : 'NIGHT PHASE - Killer acts';
            
            // Update players
            playersDiv.innerHTML = '';
            state.alivePlayerIds.forEach(playerId => {
                const player = state.playerInfo[playerId];
                const playerDiv = document.createElement('div');
                playerDiv.className = `palermo-player ${player.alive ? 'alive' : 'dead'}`;
                playerDiv.innerHTML = `
                    <div><strong>${player.username}</strong></div>
                    <div style="font-size: 12px; color: #666;">
                        ${playerId === currentUser.id ? player.role : '???'}
                    </div>
                `;
                
                if (player.alive && playerId !== currentUser.id) {
                    playerDiv.onclick = () => palermoAction(playerId);
                }
                
                playersDiv.appendChild(playerDiv);
            });
            
            // Update status
            statusDiv.textContent = state.message || 'Game in progress...';
            
            // Show dead players
            const deadPlayers = Object.keys(state.playerInfo).filter(id => !state.playerInfo[id].alive);
            if (deadPlayers.length > 0) {
                const deadDiv = document.createElement('div');
                deadDiv.innerHTML = '<h4>Dead Players:</h4>';
                deadPlayers.forEach(playerId => {
                    const player = state.playerInfo[playerId];
                    const playerDiv = document.createElement('div');
                    playerDiv.className = 'palermo-player dead';
                    playerDiv.innerHTML = `
                        <div><strong>${player.username}</strong></div>
                        <div style="font-size: 12px;">Was: ${player.role}</div>
                    `;
                    deadDiv.appendChild(playerDiv);
                });
                playersDiv.appendChild(deadDiv);
            }
        }

        function palermoAction(targetId) {
            if (currentGame) {
                socket.emit('palermoAction', { gameId: currentGame.gameId, targetId });
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Focus on username input
            document.getElementById('usernameInput').focus();
        });
    </script>
</body>
</html>